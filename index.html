<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“10è™Ÿ</title>
    <style>
        /* å­—é«”è¨­ç½®ï¼šåœ“é«”å„ªå…ˆ */
        body {
            font-family: "Yuanti SC", "YouYuan", "Microsoft YaHei", "Helvetica Neue", sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 0;
            color: #333;
            /* é˜²æ­¢iOSé»æ“Šé«˜äº® */
            -webkit-tap-highlight-color: transparent;
        }

        /* æ‹¼éŸ³å­—é«” */
        .pinyin {
            font-family: "Calibri", sans-serif;
            font-size: 1.1em;
            color: #666;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        /* æ¼¢å­—å­—é«” */
        .hanzi {
            font-size: 1.4em;
            font-weight: bold;
            line-height: 1.4;
            color: #2c3e50;
        }

        /* é ‚éƒ¨å›ºå®šæ¨™é¡Œå’Œç‰ˆæ¬Šè²æ˜ */
        #header-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 100;
            text-align: right;
            box-sizing: border-box;
        }

        #page-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        #disclaimer {
            font-size: 0.7em;
            color: #999;
            line-height: 1.2;
            max-width: 100%;
        }

        /* ä¸»å…§å®¹å€åŸŸ */
        #main-content {
            padding: 100px 20px 180px 20px; /* åº•éƒ¨ç•™ç™½çµ¦çå‹µè»Œé“ */
            max-width: 800px;
            margin: 0 auto;
        }

        /* å¥å­å®¹å™¨ */
        .sentence-container {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .sentence-container.active {
            border: 2px solid #FFD700;
            background-color: #fffcf0;
        }

        /* æ’­æ”¾æ§åˆ¶æŒ‰éˆ• */
        .play-controls {
            margin-top: 10px;
            display: flex;
            align-items: center;
        }

        .play-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.2s;
            outline: none;
        }

        .play-btn:active {
            transform: scale(0.95);
        }

        .play-btn.playing {
            background-color: #FF9800; /* æš«åœé¡è‰² */
        }

        /* çå‹µæ©Ÿåˆ¶ï¼šåº•éƒ¨è»Œé“ */
        #reward-track-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: auto; /* å…è¨±æ©«å‘æ»¾å‹• */
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
        }

        #reward-track {
            display: flex;
            align-items: center;
            padding: 0 20px;
            min-width: min-content; /* ç¢ºä¿å…§å®¹æ’é–‹å¯¬åº¦ */
        }

        .star {
            font-size: 24px;
            color: #e0e0e0; /* ç©ºå¿ƒç°è‰² */
            margin: 0 5px;
            transition: all 0.5s ease;
            position: relative;
        }

        .star.active {
            color: #FFD700;
            text-shadow: 0 0 5px #FFD700;
            transform: scale(1.2);
        }

        /* é€£æ¥ç·š */
        .track-line {
            height: 4px;
            width: 20px;
            background: #e0e0e0;
            margin: 0 2px;
            border-radius: 2px;
        }
        
        .track-line.active {
            background: #FFD700;
        }

        .trophy {
            font-size: 32px;
            color: #e0e0e0;
            margin-left: 10px;
            transition: all 0.5s;
        }

        .trophy.active {
            color: #FFD700;
            filter: drop-shadow(0 0 8px gold);
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        /* ç™»éŒ„é®ç½©å±¤ */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f0f4f8;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: "Yuanti SC", "YouYuan", sans-serif;
        }

        .login-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
            width: 80%;
            max-width: 300px;
        }

        .login-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        #login-msg {
            color: red;
            font-size: 14px;
            height: 20px;
            margin-top: 5px;
        }

        /* å®ŒæˆæŒ‰éˆ•å€åŸŸ */
        #completion-area {
            text-align: center;
            margin-top: 30px;
            padding-bottom: 20px;
        }

        #finish-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-block;
        }

        #finish-btn:active {
            transform: scale(0.95);
        }

        .home-link {
            display: block;
            margin-top: 20px;
            color: #666;
            text-decoration: none;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* å½ˆçª— */
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 80%;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* é–‹ç™¼è€…æ¨¡å¼æŒ‰éˆ• */
        #dev-trigger {
            position: fixed;
            top: 15px;
            left: 15px;
            font-size: 20px;
            color: #e0e0e0; /* å¾ˆæ·ºçš„ç°è‰² */
            cursor: pointer;
            z-index: 101;
            display: none; /* é»˜èªéš±è— */
            opacity: 0.5;
        }
        
        #dev-panel {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            z-index: 3000;
            font-family: monospace;
            box-shadow: 0 0 20px rgba(0,255,0,0.2);
        }

        .dev-controls button {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 5px 10px;
            margin: 5px;
            cursor: pointer;
        }
        
        .dev-controls button:active { background: #555; }
        
        #current-sentence-display {
            margin: 10px 0;
            padding: 5px;
            border-bottom: 1px solid #333;
            min-height: 1.5em;
        }

    </style>
</head>
<body>

    <!-- ç™»éŒ„ç•Œé¢ -->
    <div id="login-overlay">
        <h2 style="font-size: 24px; color: #2c3e50; margin-bottom: 20px;">é–‹å§‹ç·´ç¿’</h2>
        <div class="login-box">
            <input type="text" id="username" class="login-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—" autocomplete="off" onkeypress="handleEnter(event)">
            <input type="password" id="password" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" onkeypress="handleEnter(event)">
            <div id="login-msg"></div>
            <button class="login-btn" onclick="checkLogin()">é€²å…¥</button>
        </div>
    </div>

    <!-- é ‚éƒ¨æ¨™é¡Œå€ -->
    <div id="header-container">
        <div id="dev-trigger" onclick="toggleDevPanel()">ğŸ› ï¸</div>
        <div id="page-title">æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“10è™Ÿ</div>
        <div id="disclaimer">
            æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚<br>
            éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚è·æ¥­è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚
        </div>
    </div>

    <!-- ä¸»å…§å®¹å€ -->
    <div id="main-content">
        <!-- å…§å®¹å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        <div id="sentences-wrapper"></div>

        <div id="completion-area">
            <button id="finish-btn" onclick="handleCompletion()">æˆ‘å·²å®Œæˆè·Ÿè®€ç·´ç¿’å•¦ï¼</button>
            <a href="https://echo02-game.github.io/pscleadreading-hub/" class="home-link">
                <span style="font-size: 1.2em;">ğŸ“–</span> å›ä¸»ç›®éŒ„
            </a>
        </div>
    </div>

    <!-- åº•éƒ¨çå‹µè»Œé“ -->
    <div id="reward-track-container">
        <div id="reward-track">
            <!-- æ˜Ÿæ˜Ÿå°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å½ˆçª— -->
    <div id="modal">
        <div class="modal-content">
            <h3 style="color: #4CAF50; font-size: 1.5em;">å¤ªæ£’å•¦ï¼</h3>
            <p>æ‰“å¡ä¿¡æ¯å·²è¤‡è£½ï¼Œå¿«å»åˆ†äº«åŠªåŠ›å¾Œçš„å–œæ‚…å§ï¼</p>
            <button onclick="closeModal()" style="background:#ddd; border:none; padding:8px 20px; border-radius:20px; margin-top:15px;">é—œé–‰</button>
        </div>
    </div>

    <!-- éŸ³é »å…ƒç´  (å–®å€‹æ–‡ä»¶) -->
    <audio id="main-audio" preload="auto">
        <source src="pscleadreading10.mp3" type="audio/mpeg">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒéŸ³é »æ’­æ”¾ã€‚
    </audio>

    <!-- é–‹ç™¼è€…é¢æ¿ -->
    <div id="dev-panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span>é–‹ç™¼è€…éŒ„è£½æ¨¡å¼</span>
            <button onclick="toggleDevPanel()" style="background:transparent;border:none;color:#fff;">âœ•</button>
        </div>
        <div id="current-sentence-display">æº–å‚™å°±ç·’...</div>
        <div class="dev-info">
            ç•¶å‰æ™‚é–“: <span id="dev-time">0.00</span>s | 
            ç•¶å‰å¥å­ç´¢å¼•: <span id="dev-index">0</span>
        </div>
        <div class="dev-controls">
            <button onclick="startRecording()">â–¶ é–‹å§‹éŒ„è£½æ¨¡å¼</button>
            <button onclick="markNext()">ğŸš© æ¨™è¨˜ä¸‹ä¸€å¥ (Space)</button>
            <button onclick="exportJSON()">ğŸ“‹ è¤‡è£½ JSON</button>
        </div>
    </div>

<script>
    // ----------------------------------------------------
    // æ•¸æ“šé…ç½®
    // ----------------------------------------------------
    
    // æ³¨æ„ï¼šåˆå§‹æ™‚é–“è»¸è¨­ç½®ç‚º 0ï¼Œè«‹ä½¿ç”¨é–‹ç™¼è€…æ¨¡å¼ç”Ÿæˆæº–ç¢ºæ™‚é–“å¾Œæ›¿æ›æ­¤è™•
    // å·²ä¿®æ­£æ‚¨åŸæ–‡ä»¶ä¸­çš„èªæ³•éŒ¯èª¤
    const sentenceData = [
    {
        "text": "ä½œå“10è™Ÿ",
        "pinyin": "ZuÃ² pÇn shÃ­ hÃ o",
        "start": 0,
        "end": 3.11
    },
    {
        "text": "æˆ‘æ„›æœˆå¤œï¼Œä½†æˆ‘ä¹Ÿæ„›æ˜Ÿå¤©ã€‚",
        "pinyin": "WÇ’ Ã i yuÃ¨ yÃ¨, dÃ n wÇ’ yÄ› Ã i xÄ«ng tiÄn.",
        "start": 3.11,
        "end": 9.32
    },
    {
        "text": "å¾å‰åœ¨å®¶é„‰ä¸ƒå…«æœˆçš„å¤œæ™šåœ¨åº­é™¢è£ç´æ¶¼çš„æ™‚å€™ï¼Œæˆ‘æœ€æ„›çœ‹å¤©ä¸Šå¯†å¯†éº»éº»çš„ç¹æ˜Ÿã€‚",
        "pinyin": "CÃ³ng qiÃ¡n zÃ i jiÄ xiÄng qÄ« bÄ yuÃ¨ de yÃ¨ wÇn zÃ i tÃ­ng yuÃ n lÇ nÃ  liÃ¡ng de shÃ­ hou, wÇ’ zuÃ¬ Ã i kÃ n tiÄn shÃ ng mÃ¬ mi mÃ¡ mÃ¡ de fÃ¡n xÄ«ng.",
        "start": 9.32,
        "end": 21.35
    },
    {
        "text": "æœ›ç€æ˜Ÿå¤©ï¼Œæˆ‘å°±æœƒå¿˜è¨˜ä¸€åˆ‡ï¼Œä»¿ä½›å›åˆ°äº†æ¯è¦ªçš„æ‡·è£ä¼¼çš„ã€‚",
        "pinyin": "WÃ ng zhe xÄ«ng tiÄn, wÇ’ jiÃ¹ huÃ¬ wÃ ng jÃ¬ yÃ­ qiÃ¨, fÇng fÃº huÃ­ dÃ o le mÇ” qÄ«n de huÃ¡i lÇ shÃ¬ de.",
        "start": 21.35,
        "end": 30.63
    },
    {
        "text": "ä¸‰å¹´å‰åœ¨å—äº¬æˆ‘ä½çš„åœ°æ–¹æœ‰ä¸€é“å¾Œé–€ï¼Œæ¯æ™šæˆ‘æ‰“é–‹å¾Œé–€ï¼Œä¾¿çœ‹è¦‹ä¸€å€‹éœå¯‚çš„å¤œã€‚",
        "pinyin": "SÄn niÃ¡n qiÃ¡n zÃ i NÃ¡n jÄ«ng wÇ’ zhÃ¹ de dÃ¬ fang yÇ’u yÃ­ dÃ o hÃ²u mÃ©n, mÄ›i wÇn wÇ’ dÇ kÄi hÃ²u mÃ©n, biÃ n kÃ n jiÃ n yÃ­ gÃ¨ jÃ¬ng jÃ¬ de yÃ¨.",
        "start": 30.63,
        "end": 44.08
    },
    {
        "text": "ä¸‹é¢æ˜¯ä¸€ç‰‡èœåœ’ï¼Œä¸Šé¢æ˜¯æ˜Ÿç¾¤å¯†å¸ƒçš„è—å¤©ã€‚",
        "pinyin": "XiÃ  mian shÃ¬ yÃ­ piÃ n cÃ i yuÃ¡n, shÃ ng mian shÃ¬ xÄ«ng qÃºn mÃ¬ bÃ¹ de lÃ¡n tiÄn.",
        "start": 44.08,
        "end": 51.92
    },
    {
        "text": "æ˜Ÿå…‰åœ¨æˆ‘å€‘çš„è‚‰çœ¼è£é›–ç„¶å¾®å°ï¼Œç„¶è€Œå®ƒä½¿æˆ‘å€‘è¦ºå¾—å…‰æ˜ç„¡è™•ä¸åœ¨ã€‚",
        "pinyin": "XÄ«ng guÄng zÃ i wÇ’ men de rÃ²u yÇn lÇ suÄ« rÃ¡n wÄ“i xiÇo, rÃ¡n Ã©r tÄ shÇ wÇ’ men juÃ© de guÄng mÃ­ng wÃº chÃ¹ bÃº zÃ i.",
        "start": 51.92,
        "end": 62.29
    },
    {
        "text": "é‚£æ™‚å€™æˆ‘æ­£åœ¨è®€ä¸€äº›å¤©æ–‡å­¸çš„æ›¸ï¼Œä¹Ÿèªå¾—ä¸€äº›æ˜Ÿæ˜Ÿï¼Œå¥½åƒå®ƒå€‘å°±æ˜¯æˆ‘çš„æœ‹å‹ï¼Œå®ƒå€‘å¸¸å¸¸åœ¨å’Œæˆ‘è«‡è©±ä¸€æ¨£ã€‚",
        "pinyin": "NÃ  shÃ­ hou wÇ’ zhÃ¨ng zÃ i dÃº yÃ¬ xiÄ“ tiÄn wÃ©n xuÃ© de shÅ«, yÄ› rÃ¨n de yÃ¬ xiÄ“ xÄ«ng xÄ«ng, hÇo xiÃ ng tÄ men jiÃ¹ shÃ¬ wÇ’ de pÃ©ng you, tÄ men chÃ¡ng chÃ¡ng zÃ i hÃ© wÇ’ tÃ¡n huÃ  yÃ­ yÃ ng.",
        "start": 62.29,
        "end": 77.94
    },
    {
        "text": "å¦‚ä»Šåœ¨æµ·ä¸Šï¼Œæ¯æ™šå’Œç¹æ˜Ÿç›¸å°ï¼Œæˆ‘æŠŠå®ƒå€‘èªå¾—å¾ˆç†Ÿäº†ã€‚",
        "pinyin": "RÃº jÄ«n zÃ i hÇi shÃ ng, mÄ›i wÇn hÃ© fÃ¡n xÄ«ng xiÄng duÃ¬, wÇ’ bÇ tÄ men rÃ¨n de hÄ›n shÃº le.",
        "start": 77.94,
        "end": 88
    },
    {
        "text": "æˆ‘èººåœ¨è‰™é¢ä¸Šï¼Œä»°æœ›å¤©ç©ºã€‚",
        "pinyin": "WÇ’ tÇng zÃ i cÄng miÃ n shÃ ng, yÇng wÃ ng tiÄn kÅng.",
        "start": 88,
        "end": 94.5
    },
    {
        "text": "æ·±è—è‰²çš„å¤©ç©ºè£æ‡¸ç€ç„¡æ•¸åŠæ˜åŠæ˜§çš„æ˜Ÿã€‚",
        "pinyin": "ShÄ“n lÃ¡n sÃ¨ de tiÄn kÅng lÇ xuÃ¡n zhe wÃº shÃ¹ bÃ n mÃ­ng bÃ n mÃ¨i de xÄ«ng.",
        "start": 94.5,
        "end": 101.17
    },
    {
        "text": "èˆ¹åœ¨å‹•ï¼Œæ˜Ÿä¹Ÿåœ¨å‹•ï¼Œå®ƒå€‘æ˜¯é€™æ¨£ä½ï¼ŒçœŸæ˜¯æ–æ–æ¬²å¢œå‘¢ï¼",
        "pinyin": "ChuÃ¡n zÃ i dÃ²ng, xÄ«ng yÄ› zÃ i dÃ²ng, tÄ men shÃ¬ zhÃ¨ yÃ ng dÄ«, zhÄ“n shÃ¬ yÃ¡o yÃ¡o yÃ¹ zhuÃ¬ ne!",
        "start": 101.17,
        "end": 112.68
    },
    {
        "text": "æ¼¸æ¼¸åœ°æˆ‘çš„çœ¼ç›æ¨¡ç³Šäº†ï¼Œæˆ‘å¥½åƒçœ‹è¦‹ç„¡æ•¸è¢ç«èŸ²åœ¨æˆ‘çš„å‘¨åœé£›èˆã€‚",
        "pinyin": "JiÃ n jiÃ n de wÇ’ de yÇn jing mÃ³ hu le, wÇ’ hÇo xiÃ ng kÃ n jiÃ n wÃº shÃ¹ yÃ­ng huÇ’ chÃ³ng zÃ i wÇ’ de zhÅu wÃ©i fÄ“i wÇ”.",
        "start": 112.68,
        "end": 123.93
    },
    {
        "text": "æµ·ä¸Šçš„å¤œæ˜¯æŸ”å’Œçš„ï¼Œæ˜¯éœå¯‚çš„ï¼Œæ˜¯å¤¢å¹»çš„ã€‚",
        "pinyin": "HÇi shÃ ng de yÃ¨ shÃ¬ rÃ³u hÃ© de, shÃ¬ jÃ¬ng jÃ¬ de, shÃ¬ mÃ¨ng huÃ n de.",
        "start": 123.93,
        "end": 131.99
    },
    {
        "text": "æˆ‘æœ›ç€è¨±å¤šèªè­˜çš„æ˜Ÿï¼Œæˆ‘ä»¿ä½›çœ‹è¦‹å®ƒå€‘åœ¨å°æˆ‘çœ¨çœ¼ï¼Œæˆ‘ä»¿ä½›è½è¦‹å®ƒå€‘åœ¨å°è²èªªè©±ã€‚",
        "pinyin": "WÇ’ wÃ ng zhe xÇ” duÅ rÃ¨n shi de xÄ«ng, wÇ’ fÇng fÃº kÃ n jiÃ n tÄ men zÃ i duÃ¬ wÇ’ zhÇ yÇn, wÇ’ fÇng fÃº tÄ«ng jiÃ n tÄ men zÃ i xiÇo shÄ“ng shuÅ huÃ .",
        "start": 131.99,
        "end": 145.22
    },
    {
        "text": "é€™æ™‚æˆ‘å¿˜è¨˜äº†ä¸€åˆ‡ã€‚",
        "pinyin": "ZhÃ¨ shÃ­ wÇ’ wÃ ng jÃ¬ le yÃ­ qiÃ¨.",
        "start": 145.22,
        "end": 149.84
    },
    {
        "text": "åœ¨æ˜Ÿçš„æ‡·æŠ±ä¸­æˆ‘å¾®ç¬‘ç€ï¼Œæˆ‘æ²‰ç¡ç€ã€‚",
        "pinyin": "ZÃ i xÄ«ng de huÃ¡i bÃ o zhÅng wÇ’ wÄ“i xiÃ o zhe, wÇ’ chÃ©n shuÃ¬ zhe.",
        "start": 149.84,
        "end": 157.23
    },
    {
        "text": "æˆ‘è¦ºå¾—è‡ªå·±æ˜¯ä¸€å€‹å°å­©å­ï¼Œç¾åœ¨ç¡åœ¨æ¯è¦ªçš„æ‡·è£äº†ã€‚",
        "pinyin": "WÇ’ juÃ© de zÃ¬ jÇ shÃ¬ yÃ­ gÃ¨ xiÇo hÃ¡i zi, xiÃ n zÃ i shuÃ¬ zÃ i mÇ” qÄ«n de huÃ¡i lÇ le.",
        "start": 157.23,
        "end": 164.77
    },
    {
        "text": "æœ‰ä¸€å¤œï¼Œé‚£å€‹åœ¨å“¥å€«æ³¢ä¸Šèˆ¹çš„è‹±åœ‹äººæŒ‡çµ¦æˆ‘çœ‹å¤©ä¸Šçš„å·¨äººã€‚",
        "pinyin": "YÇ’u yÃ­ yÃ¨, nÃ  gÃ¨ zÃ i GÄ“ lÃºn bÅ shÃ ng chuÃ¡n de YÄ«ng guÃ³ rÃ©n zhÇ gÄ›i wÇ’ kÃ n tiÄn shÃ ng de jÃ¹ rÃ©n.",
        "start": 164.77,
        "end": 175.08
    },
    {
        "text": "ä»–ç”¨æ‰‹æŒ‡ç€ï¼š",
        "pinyin": "TÄ yÃ²ng shÇ’u zhÇ zhe:",
        "start": 175.08,
        "end": 178.17
    },
    {
        "text": "é‚£å››é¡†æ˜äº®çš„æ˜Ÿæ˜¯é ­ï¼Œä¸‹é¢çš„å¹¾é¡†æ˜¯èº«å­ï¼Œé€™å¹¾é¡†æ˜¯æ‰‹ï¼Œé‚£å¹¾é¡†æ˜¯è…¿å’Œè…³ï¼Œé‚„æœ‰ä¸‰é¡†æ˜Ÿç®—æ˜¯è…°å¸¶ã€‚",
        "pinyin": "NÃ  sÃ¬ kÄ“ mÃ­ng liÃ ng de xÄ«ng shÃ¬ tÃ³u, xiÃ  mian de jÇ kÄ“ shÃ¬ shÄ“n zi, zhÃ¨ jÇ kÄ“ shÃ¬ shÇ’u, nÃ  jÇ kÄ“ shÃ¬ tuÇ hÃ© jiÇo, hÃ¡i yÇ’u sÄn kÄ“ xÄ«ng suÃ n shÃ¬ yÄo dÃ i.",
        "start": 178.17,
        "end": 194.55
    }
];

    // ----------------------------------------------------
    // å…¨å±€è®Šé‡
    // ----------------------------------------------------
    const audio = document.getElementById('main-audio');
    let currentUser = "";
    let currentPlayingIndex = -1;
    let completedSentences = new Set();
    
    // é–‹ç™¼è€…æ¨¡å¼è®Šé‡
    let isDevMode = false;
    let recordingIndex = 0;
    let recordedTimes = [];
    let isRecording = false;

    // ----------------------------------------------------
    // åˆå§‹åŒ–é‚è¼¯
    // ----------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
        // æ¸²æŸ“å¥å­
        renderSentences();
        // æ¸²æŸ“è»Œé“
        renderTrack();
        
        // æª¢æ¸¬æ˜¯å¦ç‚º Windows (ç°¡å–®æª¢æ¸¬)
        if (navigator.platform.indexOf('Win') > -1) {
            document.getElementById('dev-trigger').style.display = 'block';
        }

        // ç›£è½éµç›¤ (å…¨å±€)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (document.getElementById('login-overlay').style.display !== 'none') {
                    checkLogin();
                }
            }
            if (e.code === 'Space' && isRecording) {
                e.preventDefault(); // é˜²æ­¢æ»¾å‹•
                markNext();
            }
        });

        // éŸ³é »æ™‚é–“æ›´æ–°ç›£è½
        audio.addEventListener('timeupdate', () => {
            if (isRecording) {
                document.getElementById('dev-time').textContent = audio.currentTime.toFixed(2);
                return; // éŒ„è£½æ¨¡å¼ä¸‹ä¸è™•ç†è‡ªå‹•æš«åœ
            }

            if (currentPlayingIndex !== -1) {
                const endTime = sentenceData[currentPlayingIndex].end;
                // å¦‚æœæœ‰çµæŸæ™‚é–“ä¸”å¤§æ–¼0 (é¿å…æœªè¨­ç½®æ™‚é–“æ™‚ç«‹å³åœæ­¢)
                if (endTime > 0 && audio.currentTime >= endTime) {
                    audio.pause();
                    // æ¨™è¨˜å®Œæˆ
                    markSentenceComplete(currentPlayingIndex);
                    resetPlayIcon(currentPlayingIndex);
                    // ä¸é‡ç½® currentPlayingIndexï¼Œä»¥ä¾¿é»æ“ŠæŒ‰éˆ•æ™‚å¯ä»¥é‡é ­æ’­æ”¾
                }
            }
        });
        
        // éŸ³é »çµæŸç›£è½
        audio.addEventListener('ended', () => {
            if (currentPlayingIndex !== -1) {
                markSentenceComplete(currentPlayingIndex);
                resetPlayIcon(currentPlayingIndex);
            }
        });
    });

    // ----------------------------------------------------
    // ç™»éŒ„é‚è¼¯
    // ----------------------------------------------------
    function checkLogin() {
        const name = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value.trim();
        const msg = document.getElementById('login-msg');

        if (!name) {
            msg.textContent = "è«‹è¼¸å…¥åå­—";
            return;
        }
        if (pass !== "vtcpsc") {
            msg.textContent = "è«‹è¼¸å…¥æ­£ç¢ºå¯†ç¢¼";
            return;
        }

        currentUser = name;
        document.getElementById('login-overlay').style.display = 'none';
    }
    
    // æ–°å¢ï¼šè™•ç†è¼¸å…¥æ¡†çš„ Enter éµ
    function handleEnter(e) {
        if (e.key === 'Enter' || e.keyCode === 13) {
            checkLogin();
        }
    }

    // ----------------------------------------------------
    // æ¸²æŸ“é‚è¼¯
    // ----------------------------------------------------
    function renderSentences() {
        const wrapper = document.getElementById('sentences-wrapper');
        wrapper.innerHTML = '';

        sentenceData.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'sentence-container';
            div.id = `sent-${index}`;
            div.innerHTML = `
                <div class="pinyin">${item.pinyin}</div>
                <div class="hanzi">${item.text}</div>
                <div class="play-controls">
                    <button class="play-btn" id="btn-${index}" onclick="togglePlay(${index})">
                        <span>â–¶</span> <span>æ’­æ”¾</span>
                    </button>
                </div>
            `;
            wrapper.appendChild(div);
        });
    }

    function renderTrack() {
        const track = document.getElementById('reward-track');
        let html = '';
        sentenceData.forEach((_, index) => {
            // ç¬¬ä¸€å€‹ä¹‹å‰çš„èµ·é»ä¸éœ€è¦ç·šï¼Œæˆ–è€…é»˜èªç¬¬ä¸€å€‹å°±æ˜¯èµ·é»
            if (index > 0) {
                html += `<div class="track-line" id="line-${index}"></div>`;
            }
            html += `<div class="star" id="star-${index}">â˜…</div>`;
        });
        html += `<div class="track-line" id="line-final"></div>`;
        html += `<div class="trophy" id="trophy">ğŸ†</div>`;
        track.innerHTML = html;
    }

    // ----------------------------------------------------
    // æ’­æ”¾é‚è¼¯
    // ----------------------------------------------------
    function togglePlay(index) {
        const btn = document.getElementById(`btn-${index}`);
        const data = sentenceData[index];

        // å¦‚æœé»æ“Šçš„æ˜¯ç•¶å‰æ­£åœ¨æ’­æ”¾çš„æŒ‰éˆ•
        if (currentPlayingIndex === index && !audio.paused) {
            audio.pause();
            btn.innerHTML = '<span>â–¶</span> <span>æ’­æ”¾</span>';
            btn.classList.remove('playing');
            return;
        }

        // å¦‚æœé»æ“Šçš„æ˜¯å¦ä¸€å€‹æŒ‰éˆ•ï¼Œæˆ–è€…ç•¶å‰æ˜¯æš«åœç‹€æ…‹
        
        // é‡ç½®æ‰€æœ‰å…¶ä»–æŒ‰éˆ•
        document.querySelectorAll('.play-btn').forEach(b => {
            b.innerHTML = '<span>â–¶</span> <span>æ’­æ”¾</span>';
            b.classList.remove('playing');
        });

        // è¨­ç½®é«˜äº®
        document.querySelectorAll('.sentence-container').forEach(c => c.classList.remove('active'));
        document.getElementById(`sent-${index}`).classList.add('active');

        // æ’­æ”¾é‚è¼¯
        // åˆ¤æ–·æ˜¯å¦æ˜¯"é‡æ–°é–‹å§‹"ï¼šå¦‚æœæ˜¯æ–°å¥å­ï¼Œæˆ–è€…èˆŠå¥å­å·²ç¶“æ’­æ”¾å®Œç•¢(currentTime >= end)
        let shouldReset = false;
        if (currentPlayingIndex !== index) {
            shouldReset = true;
        } else if (data.end > 0 && audio.currentTime >= data.end) {
            shouldReset = true;
        }

        if (shouldReset) {
            audio.currentTime = data.start;
        }

        currentPlayingIndex = index;
        audio.play().then(() => {
            btn.innerHTML = '<span>â¸</span> <span>æš«åœ</span>';
            btn.classList.add('playing');
        }).catch(err => console.error("Play error:", err));
    }

    function resetPlayIcon(index) {
        const btn = document.getElementById(`btn-${index}`);
        if (btn) {
            btn.innerHTML = '<span>â–¶</span> <span>æ’­æ”¾</span>';
            btn.classList.remove('playing');
        }
    }

    function markSentenceComplete(index) {
        if (!completedSentences.has(index)) {
            completedSentences.add(index);
            updateTrack(index);
        }
    }

    // ----------------------------------------------------
    // çå‹µæ©Ÿåˆ¶é‚è¼¯
    // ----------------------------------------------------
    function updateTrack(completedIndex) {
        // é»äº®ç•¶å‰æ˜Ÿæ˜Ÿ
        const star = document.getElementById(`star-${completedIndex}`);
        if (star) star.classList.add('active');
        
        // é»äº®å‰ä¸€æ¢ç·š
        if (completedIndex > 0) {
            const line = document.getElementById(`line-${completedIndex}`);
            if (line) line.classList.add('active');
        }

        // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
        if (completedSentences.size === sentenceData.length) {
            document.getElementById('line-final').classList.add('active');
            document.getElementById('trophy').classList.add('active');
            
            // å•Ÿç”¨å®ŒæˆæŒ‰éˆ• (é›–ç„¶éœ€æ±‚èªªæŒ‰éˆ•ä¸€ç›´å­˜åœ¨ï¼Œé€™è£¡å¯ä»¥åšå€‹ç‰¹æ•ˆæˆ–è€…è§£é–ç‹€æ…‹)
            // æ ¹æ“šéœ€æ±‚"æŒ‰éµç„¡è«–æ˜¯å¦é‹ä½œï¼ŒæŒ‰éµå‡å­˜åœ¨ã€‚ç•¶ç”¨å®¶æ’­æ”¾å®Œæ‰€æœ‰å¥å­å¾Œï¼ŒæŒ‰éµæ‰é‹ä½œ"
        }
    }

    // ----------------------------------------------------
    // å®Œæˆèˆ‡å½ˆçª—é‚è¼¯
    // ----------------------------------------------------
    function handleCompletion() {
        if (completedSentences.size < sentenceData.length) {
            alert("è«‹å…ˆå®Œæˆæ‰€æœ‰å¥å­çš„è·Ÿè®€ç·´ç¿’å“¦ï¼åŠ æ²¹ï¼");
            return;
        }

        const date = new Date();
        const dateStr = `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
        const textToCopy = `${currentUser}å·²æ–¼${dateStr}å®Œæˆä½œå“10è™Ÿè·Ÿè®€ç·´ç¿’ï¼`;

        // è¤‡è£½åˆ°å‰ªè²¼æ¿
        if (navigator.clipboard) {
            navigator.clipboard.writeText(textToCopy).then(() => {
                showModal();
            }).catch(() => {
                // é™ç´šè™•ç†
                fallbackCopy(textToCopy);
                showModal();
            });
        } else {
            fallbackCopy(textToCopy);
            showModal();
        }
    }

    function fallbackCopy(text) {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
    }

    function showModal() {
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    // ----------------------------------------------------
    // é–‹ç™¼è€…æ¨¡å¼é‚è¼¯ (éŒ„è£½æ™‚é–“è»¸)
    // ----------------------------------------------------
    function toggleDevPanel() {
        const panel = document.getElementById('dev-panel');
        isDevMode = !isDevMode;
        panel.style.display = isDevMode ? 'block' : 'none';
        
        if (isDevMode) {
            // åˆå§‹åŒ–éŒ„è£½ç‹€æ…‹
            recordingIndex = 0;
            recordedTimes = [];
            isRecording = false;
            updateDevDisplay();
        }
    }

    function startRecording() {
        isRecording = true;
        recordingIndex = 0;
        recordedTimes = [];
        
        // è¨˜éŒ„ç¬¬ä¸€å¥é–‹å§‹æ™‚é–“ (0)
        recordedTimes.push({ start: 0 });
        
        audio.currentTime = 0;
        audio.play();
        updateDevDisplay();
    }

    function markNext() {
        if (!isRecording) return;
        
        const now = audio.currentTime;
        
        // è¨˜éŒ„ç•¶å‰å¥å­çš„çµæŸæ™‚é–“
        if (recordedTimes[recordingIndex]) {
            recordedTimes[recordingIndex].end = parseFloat(now.toFixed(2));
        }

        // æº–å‚™ä¸‹ä¸€å¥
        recordingIndex++;
        if (recordingIndex < sentenceData.length) {
            // ä¸‹ä¸€å¥é–‹å§‹æ™‚é–“ = ç•¶å‰æ™‚é–“
            recordedTimes.push({ start: parseFloat(now.toFixed(2)) });
            updateDevDisplay();
        } else {
            // çµæŸ
            isRecording = false;
            audio.pause();
            document.getElementById('current-sentence-display').innerText = "éŒ„è£½å®Œæˆï¼è«‹é»æ“Šè¤‡è£½ JSON";
            document.getElementById('dev-index').innerText = "End";
        }
    }

    function updateDevDisplay() {
        if (recordingIndex < sentenceData.length) {
            const txt = sentenceData[recordingIndex].text;
            document.getElementById('current-sentence-display').innerText = `æ­£åœ¨éŒ„è£½ [${recordingIndex}]: ${txt}`;
            document.getElementById('dev-index').innerText = recordingIndex;
        }
    }

    function exportJSON() {
        // åˆä½µåŸæ•¸æ“šå’Œæ™‚é–“
        const newData = sentenceData.map((item, idx) => {
            const time = recordedTimes[idx] || { start: 0, end: 0 };
            return {
                ...item,
                start: time.start || 0,
                end: time.end || 0
            };
        });
        
        const jsonStr = JSON.stringify(newData, null, 4);
        
        // è¤‡è£½
        const ta = document.createElement('textarea');
        ta.value = `const sentenceData = ${jsonStr};`;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        
        alert("JSON å·²è¤‡è£½ï¼è«‹æ›¿æ›ä»£ç¢¼ä¸­çš„ sentenceData è®Šé‡ã€‚");
    }

</script>
</body>
</html>
